{"cells":[{"cell_type":"markdown","metadata":{"id":"gXG3QdhVLmkk"},"source":["Для выполнения заданий возьмите данные из папки [data](https://drive.google.com/drive/folders/17E4vB5kWr5FNjLKRU4XGoJSVTxn1jkg4?usp=sharing) о продажах. Данные распределены по 4 папкам:\n","* sales_train.csv - данные о продажах с января 2013 по октябрь 2015.\n","** date - дата продажы\n","** date_block_num - номер месяца по порядку следования\n","** shop_id - идентификатор магазина\n","** item_id - идентификатор товара\n","** item_price - цена товара\n","** item_cnt_day - количество проданного товара одного вида в день\n","\n","* items.csv - подробная информация о товарах\n","** item_id - идентификатор товара\n","** item_name - название товара\n","** category_id - идентификатор категории товара\n","\n","* item_categories.csv - подробная информация о категориях товаров\n","** item_category_id - идентификатор категории товара\n","** category_name - название категории товара\n","\n","* shops.csv - подробная информация о магазинах\n","** shop_id - идентификатор магазина\n","** shop_name - название магазина\n"]},{"cell_type":"code","source":["library(tidyverse)"],"metadata":{"id":"ejMQTaeNkXjY"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["sales <- read.csv(\"sales_train.csv\", header = TRUE, stringsAsFactors = FALSE)"],"metadata":{"id":"9UbkYeTNfdNp"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["items <- read.csv(\"items.csv\", header = TRUE, stringsAsFactors = FALSE)"],"metadata":{"id":"o9uKFTPI3Jau"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["item_categories <- read.csv(\"item_categories.csv\", header = TRUE, stringsAsFactors = FALSE)"],"metadata":{"id":"l-5qC6CD3XXM"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["shops <- read.csv(\"shops.csv\", header = TRUE, stringsAsFactors = FALSE)"],"metadata":{"id":"7g7adwMy3chb"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"X5oEdrHBJ9t8"},"source":["# Задание 1"]},{"cell_type":"markdown","metadata":{"id":"8tjm8ZhmKCDv"},"source":["1. Найдите топ-10 самых часто покупаемых товаров (не забудьте учесть столбец item_cnt_day).\n","2. Оставьте только те из них, которые покупали все три года (2013, 2014, 2015)."]},{"cell_type":"code","source":["#sales"],"metadata":{"id":"orN2Iw1ffe8U"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"28PAW2PqiOeK"},"outputs":[],"source":["unique_items <- c(unique(sales$item_id))\n","count <- c()\n","for (item in unique_items){\n","  count <- c(count, sum(sales[sales$item_id == item, 'item_cnt_day']))\n","}"]},{"cell_type":"code","source":["top <- data.frame(item_id=(unique_items), all_count=(count))"],"metadata":{"id":"FBLVhI1Ygtnk"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["#top"],"metadata":{"id":"eXxVpo0IhHGA"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"HzL2Ymj6GeEb"},"outputs":[],"source":["top10 <- head(top[order(top$all_count, decreasing=TRUE),], n=10)"]},{"cell_type":"markdown","source":["Топ-10 самых часто покупаемых товаров:"],"metadata":{"id":"ROJFpQKttpF6"}},{"cell_type":"code","source":["top10"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":412},"id":"bENFSJ-zh5d7","executionInfo":{"status":"ok","timestamp":1648586567090,"user_tz":-180,"elapsed":51,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"f61a9e47-566b-4905-9091-5b4f0cb156be"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 10 × 2</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>item_id</th><th scope=col>all_count</th></tr>\n","\t<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>10409</th><td>20949</td><td>187642</td></tr>\n","\t<tr><th scope=row>42</th><td> 2808</td><td> 17245</td></tr>\n","\t<tr><th scope=row>12924</th><td> 3732</td><td> 16642</td></tr>\n","\t<tr><th scope=row>2149</th><td>17717</td><td> 15830</td></tr>\n","\t<tr><th scope=row>554</th><td> 5822</td><td> 14515</td></tr>\n","\t<tr><th scope=row>12925</th><td> 3734</td><td> 11688</td></tr>\n","\t<tr><th scope=row>13964</th><td> 6675</td><td> 10289</td></tr>\n","\t<tr><th scope=row>19810</th><td> 3731</td><td> 10099</td></tr>\n","\t<tr><th scope=row>13316</th><td> 1855</td><td> 10032</td></tr>\n","\t<tr><th scope=row>11513</th><td>16787</td><td>  9227</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 10 × 2\n\n| <!--/--> | item_id &lt;int&gt; | all_count &lt;dbl&gt; |\n|---|---|---|\n| 10409 | 20949 | 187642 |\n| 42 |  2808 |  17245 |\n| 12924 |  3732 |  16642 |\n| 2149 | 17717 |  15830 |\n| 554 |  5822 |  14515 |\n| 12925 |  3734 |  11688 |\n| 13964 |  6675 |  10289 |\n| 19810 |  3731 |  10099 |\n| 13316 |  1855 |  10032 |\n| 11513 | 16787 |   9227 |\n\n","text/latex":"A data.frame: 10 × 2\n\\begin{tabular}{r|ll}\n  & item\\_id & all\\_count\\\\\n  & <int> & <dbl>\\\\\n\\hline\n\t10409 & 20949 & 187642\\\\\n\t42 &  2808 &  17245\\\\\n\t12924 &  3732 &  16642\\\\\n\t2149 & 17717 &  15830\\\\\n\t554 &  5822 &  14515\\\\\n\t12925 &  3734 &  11688\\\\\n\t13964 &  6675 &  10289\\\\\n\t19810 &  3731 &  10099\\\\\n\t13316 &  1855 &  10032\\\\\n\t11513 & 16787 &   9227\\\\\n\\end{tabular}\n","text/plain":["      item_id all_count\n","10409 20949   187642   \n","42     2808    17245   \n","12924  3732    16642   \n","2149  17717    15830   \n","554    5822    14515   \n","12925  3734    11688   \n","13964  6675    10289   \n","19810  3731    10099   \n","13316  1855    10032   \n","11513 16787     9227   "]},"metadata":{}}]},{"cell_type":"code","source":["c_2013 <- c()\n","c_2014 <- c()\n","c_2015 <- c()\n","for (item in top10$item_id){\n","  date <- str_sub(sales[sales$item_id == item, 'date'], start=7)\n","  c_2013 <- c(c_2013, sum(sales[sales$item_id == item & str_sub(sales$date, start=7) == '2013', 'item_cnt_day']))\n","  c_2014 <- c(c_2014, sum(sales[sales$item_id == item & str_sub(sales$date, start=7) == '2014', 'item_cnt_day']))\n","  c_2015 <- c(c_2015, sum(sales[sales$item_id == item & str_sub(sales$date, start=7) == '2015', 'item_cnt_day']))\n","}"],"metadata":{"id":"TBYb7lf8iBru"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["top10$'2013' <- c_2013\n","top10$'2014' <- c_2014\n","top10$'2015' <- c_2015"],"metadata":{"id":"z6rv9_sHmSav"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["Топ-10 (покупаемых все 3 года):"],"metadata":{"id":"ZMD3Wmc1tzvu"}},{"cell_type":"code","source":["top10[((top10$'2013' != 0) & (top10$'2014' != 0) & (top10$'2015' != 0)), ]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":380},"id":"xjJNs7XFmxsE","executionInfo":{"status":"ok","timestamp":1648586574983,"user_tz":-180,"elapsed":66,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"c7047541-ba43-4187-d4d3-18e83dcc02f1"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 9 × 5</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>item_id</th><th scope=col>all_count</th><th scope=col>2013</th><th scope=col>2014</th><th scope=col>2015</th></tr>\n","\t<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>10409</th><td>20949</td><td>187642</td><td>63748</td><td>85288</td><td>38606</td></tr>\n","\t<tr><th scope=row>42</th><td> 2808</td><td> 17245</td><td>12214</td><td> 4030</td><td> 1001</td></tr>\n","\t<tr><th scope=row>12924</th><td> 3732</td><td> 16642</td><td>11981</td><td> 3819</td><td>  842</td></tr>\n","\t<tr><th scope=row>2149</th><td>17717</td><td> 15830</td><td> 1170</td><td> 7392</td><td> 7268</td></tr>\n","\t<tr><th scope=row>554</th><td> 5822</td><td> 14515</td><td> 3845</td><td> 6542</td><td> 4128</td></tr>\n","\t<tr><th scope=row>12925</th><td> 3734</td><td> 11688</td><td> 7649</td><td> 3163</td><td>  876</td></tr>\n","\t<tr><th scope=row>13964</th><td> 6675</td><td> 10289</td><td> 3766</td><td> 5533</td><td>  990</td></tr>\n","\t<tr><th scope=row>13316</th><td> 1855</td><td> 10032</td><td> 4047</td><td> 5192</td><td>  793</td></tr>\n","\t<tr><th scope=row>11513</th><td>16787</td><td>  9227</td><td> 6430</td><td> 2458</td><td>  339</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 9 × 5\n\n| <!--/--> | item_id &lt;int&gt; | all_count &lt;dbl&gt; | 2013 &lt;dbl&gt; | 2014 &lt;dbl&gt; | 2015 &lt;dbl&gt; |\n|---|---|---|---|---|---|\n| 10409 | 20949 | 187642 | 63748 | 85288 | 38606 |\n| 42 |  2808 |  17245 | 12214 |  4030 |  1001 |\n| 12924 |  3732 |  16642 | 11981 |  3819 |   842 |\n| 2149 | 17717 |  15830 |  1170 |  7392 |  7268 |\n| 554 |  5822 |  14515 |  3845 |  6542 |  4128 |\n| 12925 |  3734 |  11688 |  7649 |  3163 |   876 |\n| 13964 |  6675 |  10289 |  3766 |  5533 |   990 |\n| 13316 |  1855 |  10032 |  4047 |  5192 |   793 |\n| 11513 | 16787 |   9227 |  6430 |  2458 |   339 |\n\n","text/latex":"A data.frame: 9 × 5\n\\begin{tabular}{r|lllll}\n  & item\\_id & all\\_count & 2013 & 2014 & 2015\\\\\n  & <int> & <dbl> & <dbl> & <dbl> & <dbl>\\\\\n\\hline\n\t10409 & 20949 & 187642 & 63748 & 85288 & 38606\\\\\n\t42 &  2808 &  17245 & 12214 &  4030 &  1001\\\\\n\t12924 &  3732 &  16642 & 11981 &  3819 &   842\\\\\n\t2149 & 17717 &  15830 &  1170 &  7392 &  7268\\\\\n\t554 &  5822 &  14515 &  3845 &  6542 &  4128\\\\\n\t12925 &  3734 &  11688 &  7649 &  3163 &   876\\\\\n\t13964 &  6675 &  10289 &  3766 &  5533 &   990\\\\\n\t13316 &  1855 &  10032 &  4047 &  5192 &   793\\\\\n\t11513 & 16787 &   9227 &  6430 &  2458 &   339\\\\\n\\end{tabular}\n","text/plain":["      item_id all_count 2013  2014  2015 \n","10409 20949   187642    63748 85288 38606\n","42     2808    17245    12214  4030  1001\n","12924  3732    16642    11981  3819   842\n","2149  17717    15830     1170  7392  7268\n","554    5822    14515     3845  6542  4128\n","12925  3734    11688     7649  3163   876\n","13964  6675    10289     3766  5533   990\n","13316  1855    10032     4047  5192   793\n","11513 16787     9227     6430  2458   339"]},"metadata":{}}]},{"cell_type":"markdown","metadata":{"id":"oaood23UKK5e"},"source":["# Задание 2"]},{"cell_type":"markdown","metadata":{"id":"6fKaQTb0KK5f"},"source":["> При выполнении на pandas не используйте merge().\n","\n","1. Определите категорию товаров, в которой совершается минимальное число покупок. Выведите айди и название категории.\n","2. Определите категорию товаров, в которой совершается максимальное число покупок. Выведите айди и название категории."]},{"cell_type":"code","source":["count_by_category <- data.frame(id_category=(unique(item_categories$item_category_id)), all_count=(0))"],"metadata":{"id":"KFyDJFS_pIsB"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["#count_by_category"],"metadata":{"id":"T2eu3r9M8VKb"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["for (id in count_by_category$id_category){\n","  count_by_category$all_count[count_by_category$id_category == id] <-  sum(top[top$item_id %in% items[items$category_id == id, 'item_id'] , 'all_count'])\n","}"],"metadata":{"id":"BYMeZZ4f8n5Q"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["#count_by_category[order(count_by_category$all_count, decreasing=TRUE),]"],"metadata":{"id":"stZXb3jX_EpF"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["min_count <- min(count_by_category$all_count)\n","max_count <- max(count_by_category$all_count)"],"metadata":{"id":"1LjGnkQz_WDI"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["Категория товаров, в которой совершается максимальное число покупок"],"metadata":{"id":"8SPf69Q2uFjm"}},{"cell_type":"code","source":["id_max <- count_by_category[count_by_category$all_count == max_count, ]\n","item_categories[id_max$id_category+1, ]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":129},"id":"hVcK67N0_ebp","executionInfo":{"status":"ok","timestamp":1648586575290,"user_tz":-180,"elapsed":27,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"830d892b-f80d-4423-e9bd-a642319ddab0"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 1 × 2</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>item_category_name</th><th scope=col>item_category_id</th></tr>\n","\t<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>41</th><td> Cinema - DVD</td><td>40</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 1 × 2\n\n| <!--/--> | item_category_name &lt;chr&gt; | item_category_id &lt;int&gt; |\n|---|---|---|\n| 41 |  Cinema - DVD | 40 |\n\n","text/latex":"A data.frame: 1 × 2\n\\begin{tabular}{r|ll}\n  & item\\_category\\_name & item\\_category\\_id\\\\\n  & <chr> & <int>\\\\\n\\hline\n\t41 &  Cinema - DVD & 40\\\\\n\\end{tabular}\n","text/plain":["   item_category_name item_category_id\n","41  Cinema - DVD      40              "]},"metadata":{}}]},{"cell_type":"markdown","source":["Категории товаров, в которой совершается минимальное число покупок"],"metadata":{"id":"iPrOZhtTuDQh"}},{"cell_type":"code","source":["id_min <- count_by_category[count_by_category$all_count == min_count, ]\n","item_categories[id_min$id_category+1, ]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":161},"id":"gC1-uSJXA4D8","executionInfo":{"status":"ok","timestamp":1648586575292,"user_tz":-180,"elapsed":27,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"98d6a4ed-6933-4200-a280-2fdc6be6a93d"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 2 × 2</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>item_category_name</th><th scope=col>item_category_id</th></tr>\n","\t<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>11</th><td> Game consoles - PS2         </td><td>10</td></tr>\n","\t<tr><th scope=row>52</th><td> Books - Cognitive literature</td><td>51</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 2 × 2\n\n| <!--/--> | item_category_name &lt;chr&gt; | item_category_id &lt;int&gt; |\n|---|---|---|\n| 11 |  Game consoles - PS2          | 10 |\n| 52 |  Books - Cognitive literature | 51 |\n\n","text/latex":"A data.frame: 2 × 2\n\\begin{tabular}{r|ll}\n  & item\\_category\\_name & item\\_category\\_id\\\\\n  & <chr> & <int>\\\\\n\\hline\n\t11 &  Game consoles - PS2          & 10\\\\\n\t52 &  Books - Cognitive literature & 51\\\\\n\\end{tabular}\n","text/plain":["   item_category_name            item_category_id\n","11  Game consoles - PS2          10              \n","52  Books - Cognitive literature 51              "]},"metadata":{}}]},{"cell_type":"markdown","metadata":{"id":"a99rnQRwKLLR"},"source":["# Задание 3"]},{"cell_type":"markdown","metadata":{"id":"sxh1WWITKLLS"},"source":["1. Для категорий из задания 2 найдите среднее количество продаж каждого товара категории в 5 магазинах с наибольшими продажами.\n","2. Найдите месяцы с минимальными и максимальными продажами для каждого товара из пункта 1.\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"MoRKW5P3KLLS"},"outputs":[],"source":["top_shops <- data.frame(shop_id=(unique(shops$shop_id)), all_count=(0))\n","for (shop in unique(shops$shop_id)){\n","  top_shops$all_count[top_shops$shop_id == shop] <- sum(sales[sales$shop_id == shop, 'item_cnt_day'])\n","}"]},{"cell_type":"code","source":["top5 <- head(top_shops[order(top_shops$all_count, decreasing=TRUE),], n=5)\n","top5"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":255},"id":"MzE1Heowb8ab","executionInfo":{"status":"ok","timestamp":1648586576314,"user_tz":-180,"elapsed":35,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"44ac25e0-a072-415d-f453-fb38c5f1d512"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 5 × 2</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>shop_id</th><th scope=col>all_count</th></tr>\n","\t<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>32</th><td>31</td><td>310777</td></tr>\n","\t<tr><th scope=row>26</th><td>25</td><td>241920</td></tr>\n","\t<tr><th scope=row>55</th><td>54</td><td>185790</td></tr>\n","\t<tr><th scope=row>29</th><td>28</td><td>184557</td></tr>\n","\t<tr><th scope=row>43</th><td>42</td><td>144934</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 5 × 2\n\n| <!--/--> | shop_id &lt;int&gt; | all_count &lt;dbl&gt; |\n|---|---|---|\n| 32 | 31 | 310777 |\n| 26 | 25 | 241920 |\n| 55 | 54 | 185790 |\n| 29 | 28 | 184557 |\n| 43 | 42 | 144934 |\n\n","text/latex":"A data.frame: 5 × 2\n\\begin{tabular}{r|ll}\n  & shop\\_id & all\\_count\\\\\n  & <int> & <dbl>\\\\\n\\hline\n\t32 & 31 & 310777\\\\\n\t26 & 25 & 241920\\\\\n\t55 & 54 & 185790\\\\\n\t29 & 28 & 184557\\\\\n\t43 & 42 & 144934\\\\\n\\end{tabular}\n","text/plain":["   shop_id all_count\n","32 31      310777   \n","26 25      241920   \n","55 54      185790   \n","29 28      184557   \n","43 42      144934   "]},"metadata":{}}]},{"cell_type":"code","source":["need_categories <- c(item_categories[id_max$id_category+1, 'item_category_id'], item_categories[id_min$id_category+1, 'item_category_id'])\n","#need_categories"],"metadata":{"id":"A0XecZgYfwNZ"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["need_items <- c()\n","for (categ in need_categories){\n","  need_items <- c(need_items, items[items$category_id == categ, 'item_id'])\n","}\n"],"metadata":{"id":"kXxaHym7gOnj"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["sales_only_need_items <- sales[sales$item_id %in% need_items, ]\n","#sales_only_need_items"],"metadata":{"id":"HrKeF7KYg-L_"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["sales_by_top_shops <- sales_only_need_items[sales_only_need_items$shop_id %in% top5$shop_id,]\n","#sales_by_top_shops"],"metadata":{"id":"Gh-eZVeYhfsU"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["average_sales_items_by_shops <- data.frame(item_id=(unique(sales_by_top_shops$item_id)), average_count_sales=(0))"],"metadata":{"id":"xc4LU-slm0_2"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["Среднее количество продаж каждого товара категории в 5 магазинах с наибольшими продажами для категорий из задания 2"],"metadata":{"id":"7OZeferOuTwO"}},{"cell_type":"code","source":["\n","for (item in unique(sales_by_top_shops$item_id)){\n","  average <- 0\n","  for (shop in unique(sales_by_top_shops$shop_id)){\n","    average <- average + sum(sales_by_top_shops[(sales_by_top_shops$item_id == item) & (sales_by_top_shops$shop_id == shop), 'item_cnt_day'])\n","  }\n","  average_sales_items_by_shops$average_count_sales[average_sales_items_by_shops$item_id == item] <- average / 5\n","}\n","average_sales_items_by_shops"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"TE6ASHOmlveK","executionInfo":{"status":"ok","timestamp":1648586628897,"user_tz":-180,"elapsed":52261,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"0030493c-7174-43cb-f961-9bc11df8b2ec"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 4714 × 2</caption>\n","<thead>\n","\t<tr><th scope=col>item_id</th><th scope=col>average_count_sales</th></tr>\n","\t<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><td> 2462</td><td>  3.6</td></tr>\n","\t<tr><td> 3112</td><td>  5.4</td></tr>\n","\t<tr><td> 3093</td><td>  1.2</td></tr>\n","\t<tr><td>  977</td><td>  4.4</td></tr>\n","\t<tr><td>  987</td><td> 29.0</td></tr>\n","\t<tr><td> 1113</td><td>  4.8</td></tr>\n","\t<tr><td> 1118</td><td>  4.0</td></tr>\n","\t<tr><td> 1070</td><td>  0.8</td></tr>\n","\t<tr><td> 1097</td><td>  3.4</td></tr>\n","\t<tr><td> 5416</td><td>  8.0</td></tr>\n","\t<tr><td> 5525</td><td>  1.0</td></tr>\n","\t<tr><td> 3582</td><td>  4.2</td></tr>\n","\t<tr><td> 3603</td><td>  1.8</td></tr>\n","\t<tr><td>   98</td><td> 37.0</td></tr>\n","\t<tr><td>   72</td><td>  4.8</td></tr>\n","\t<tr><td>   75</td><td>  4.2</td></tr>\n","\t<tr><td>   88</td><td>  3.4</td></tr>\n","\t<tr><td>   89</td><td>  1.6</td></tr>\n","\t<tr><td>   32</td><td>166.6</td></tr>\n","\t<tr><td>   34</td><td>  7.8</td></tr>\n","\t<tr><td>   35</td><td> 18.0</td></tr>\n","\t<tr><td>   19</td><td>  0.2</td></tr>\n","\t<tr><td>14346</td><td> 65.8</td></tr>\n","\t<tr><td>14349</td><td>  1.0</td></tr>\n","\t<tr><td>14354</td><td>  9.0</td></tr>\n","\t<tr><td>14367</td><td>  4.8</td></tr>\n","\t<tr><td>14376</td><td>  3.2</td></tr>\n","\t<tr><td>14380</td><td>  4.2</td></tr>\n","\t<tr><td>14389</td><td> 45.0</td></tr>\n","\t<tr><td>14390</td><td> 44.2</td></tr>\n","\t<tr><td>⋮</td><td>⋮</td></tr>\n","\t<tr><td> 8699</td><td>2.6</td></tr>\n","\t<tr><td> 8397</td><td>4.4</td></tr>\n","\t<tr><td> 8327</td><td>2.0</td></tr>\n","\t<tr><td>21449</td><td>3.8</td></tr>\n","\t<tr><td>21548</td><td>3.6</td></tr>\n","\t<tr><td>21604</td><td>1.0</td></tr>\n","\t<tr><td>20264</td><td>0.6</td></tr>\n","\t<tr><td>20266</td><td>1.2</td></tr>\n","\t<tr><td>22006</td><td>2.6</td></tr>\n","\t<tr><td>22005</td><td>3.2</td></tr>\n","\t<tr><td>22004</td><td>3.8</td></tr>\n","\t<tr><td>19204</td><td>0.6</td></tr>\n","\t<tr><td>19552</td><td>0.6</td></tr>\n","\t<tr><td>18530</td><td>0.2</td></tr>\n","\t<tr><td>14399</td><td>0.2</td></tr>\n","\t<tr><td>17902</td><td>0.2</td></tr>\n","\t<tr><td>15597</td><td>0.2</td></tr>\n","\t<tr><td>12688</td><td>1.6</td></tr>\n","\t<tr><td>21664</td><td>0.2</td></tr>\n","\t<tr><td>18938</td><td>0.2</td></tr>\n","\t<tr><td>11572</td><td>0.2</td></tr>\n","\t<tr><td>11766</td><td>0.8</td></tr>\n","\t<tr><td>12700</td><td>0.2</td></tr>\n","\t<tr><td>12706</td><td>0.4</td></tr>\n","\t<tr><td>12671</td><td>0.6</td></tr>\n","\t<tr><td>10062</td><td>0.2</td></tr>\n","\t<tr><td>10072</td><td>0.6</td></tr>\n","\t<tr><td>  986</td><td>0.2</td></tr>\n","\t<tr><td>14709</td><td>0.2</td></tr>\n","\t<tr><td> 8428</td><td>0.2</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 4714 × 2\n\n| item_id &lt;int&gt; | average_count_sales &lt;dbl&gt; |\n|---|---|\n|  2462 |   3.6 |\n|  3112 |   5.4 |\n|  3093 |   1.2 |\n|   977 |   4.4 |\n|   987 |  29.0 |\n|  1113 |   4.8 |\n|  1118 |   4.0 |\n|  1070 |   0.8 |\n|  1097 |   3.4 |\n|  5416 |   8.0 |\n|  5525 |   1.0 |\n|  3582 |   4.2 |\n|  3603 |   1.8 |\n|    98 |  37.0 |\n|    72 |   4.8 |\n|    75 |   4.2 |\n|    88 |   3.4 |\n|    89 |   1.6 |\n|    32 | 166.6 |\n|    34 |   7.8 |\n|    35 |  18.0 |\n|    19 |   0.2 |\n| 14346 |  65.8 |\n| 14349 |   1.0 |\n| 14354 |   9.0 |\n| 14367 |   4.8 |\n| 14376 |   3.2 |\n| 14380 |   4.2 |\n| 14389 |  45.0 |\n| 14390 |  44.2 |\n| ⋮ | ⋮ |\n|  8699 | 2.6 |\n|  8397 | 4.4 |\n|  8327 | 2.0 |\n| 21449 | 3.8 |\n| 21548 | 3.6 |\n| 21604 | 1.0 |\n| 20264 | 0.6 |\n| 20266 | 1.2 |\n| 22006 | 2.6 |\n| 22005 | 3.2 |\n| 22004 | 3.8 |\n| 19204 | 0.6 |\n| 19552 | 0.6 |\n| 18530 | 0.2 |\n| 14399 | 0.2 |\n| 17902 | 0.2 |\n| 15597 | 0.2 |\n| 12688 | 1.6 |\n| 21664 | 0.2 |\n| 18938 | 0.2 |\n| 11572 | 0.2 |\n| 11766 | 0.8 |\n| 12700 | 0.2 |\n| 12706 | 0.4 |\n| 12671 | 0.6 |\n| 10062 | 0.2 |\n| 10072 | 0.6 |\n|   986 | 0.2 |\n| 14709 | 0.2 |\n|  8428 | 0.2 |\n\n","text/latex":"A data.frame: 4714 × 2\n\\begin{tabular}{ll}\n item\\_id & average\\_count\\_sales\\\\\n <int> & <dbl>\\\\\n\\hline\n\t  2462 &   3.6\\\\\n\t  3112 &   5.4\\\\\n\t  3093 &   1.2\\\\\n\t   977 &   4.4\\\\\n\t   987 &  29.0\\\\\n\t  1113 &   4.8\\\\\n\t  1118 &   4.0\\\\\n\t  1070 &   0.8\\\\\n\t  1097 &   3.4\\\\\n\t  5416 &   8.0\\\\\n\t  5525 &   1.0\\\\\n\t  3582 &   4.2\\\\\n\t  3603 &   1.8\\\\\n\t    98 &  37.0\\\\\n\t    72 &   4.8\\\\\n\t    75 &   4.2\\\\\n\t    88 &   3.4\\\\\n\t    89 &   1.6\\\\\n\t    32 & 166.6\\\\\n\t    34 &   7.8\\\\\n\t    35 &  18.0\\\\\n\t    19 &   0.2\\\\\n\t 14346 &  65.8\\\\\n\t 14349 &   1.0\\\\\n\t 14354 &   9.0\\\\\n\t 14367 &   4.8\\\\\n\t 14376 &   3.2\\\\\n\t 14380 &   4.2\\\\\n\t 14389 &  45.0\\\\\n\t 14390 &  44.2\\\\\n\t ⋮ & ⋮\\\\\n\t  8699 & 2.6\\\\\n\t  8397 & 4.4\\\\\n\t  8327 & 2.0\\\\\n\t 21449 & 3.8\\\\\n\t 21548 & 3.6\\\\\n\t 21604 & 1.0\\\\\n\t 20264 & 0.6\\\\\n\t 20266 & 1.2\\\\\n\t 22006 & 2.6\\\\\n\t 22005 & 3.2\\\\\n\t 22004 & 3.8\\\\\n\t 19204 & 0.6\\\\\n\t 19552 & 0.6\\\\\n\t 18530 & 0.2\\\\\n\t 14399 & 0.2\\\\\n\t 17902 & 0.2\\\\\n\t 15597 & 0.2\\\\\n\t 12688 & 1.6\\\\\n\t 21664 & 0.2\\\\\n\t 18938 & 0.2\\\\\n\t 11572 & 0.2\\\\\n\t 11766 & 0.8\\\\\n\t 12700 & 0.2\\\\\n\t 12706 & 0.4\\\\\n\t 12671 & 0.6\\\\\n\t 10062 & 0.2\\\\\n\t 10072 & 0.6\\\\\n\t   986 & 0.2\\\\\n\t 14709 & 0.2\\\\\n\t  8428 & 0.2\\\\\n\\end{tabular}\n","text/plain":["     item_id average_count_sales\n","1     2462     3.6              \n","2     3112     5.4              \n","3     3093     1.2              \n","4      977     4.4              \n","5      987    29.0              \n","6     1113     4.8              \n","7     1118     4.0              \n","8     1070     0.8              \n","9     1097     3.4              \n","10    5416     8.0              \n","11    5525     1.0              \n","12    3582     4.2              \n","13    3603     1.8              \n","14      98    37.0              \n","15      72     4.8              \n","16      75     4.2              \n","17      88     3.4              \n","18      89     1.6              \n","19      32   166.6              \n","20      34     7.8              \n","21      35    18.0              \n","22      19     0.2              \n","23   14346    65.8              \n","24   14349     1.0              \n","25   14354     9.0              \n","26   14367     4.8              \n","27   14376     3.2              \n","28   14380     4.2              \n","29   14389    45.0              \n","30   14390    44.2              \n","⋮    ⋮       ⋮                  \n","4685  8699   2.6                \n","4686  8397   4.4                \n","4687  8327   2.0                \n","4688 21449   3.8                \n","4689 21548   3.6                \n","4690 21604   1.0                \n","4691 20264   0.6                \n","4692 20266   1.2                \n","4693 22006   2.6                \n","4694 22005   3.2                \n","4695 22004   3.8                \n","4696 19204   0.6                \n","4697 19552   0.6                \n","4698 18530   0.2                \n","4699 14399   0.2                \n","4700 17902   0.2                \n","4701 15597   0.2                \n","4702 12688   1.6                \n","4703 21664   0.2                \n","4704 18938   0.2                \n","4705 11572   0.2                \n","4706 11766   0.8                \n","4707 12700   0.2                \n","4708 12706   0.4                \n","4709 12671   0.6                \n","4710 10062   0.2                \n","4711 10072   0.6                \n","4712   986   0.2                \n","4713 14709   0.2                \n","4714  8428   0.2                "]},"metadata":{}}]},{"cell_type":"code","source":["ids <- c()\n","months <- c()\n","summ <- c()\n","for (item in unique(sales_only_need_items$item_id)){\n","  for (month in unique(sales_only_need_items$date_block_num)){\n","    ids <- c(ids, item)\n","    months <- c(months, month)\n","    summ <- c(summ, sum(sales_only_need_items[(sales_only_need_items$item_id == item) & (sales_only_need_items$date_block_num == month), 'item_cnt_day']))\n","  }\n","}\n","item_sales_by_month <- data.frame(item_id=(ids), month=(months), sum_count_sales=(summ))\n","#item_sales_by_month"],"metadata":{"id":"jbkCJPQ5qqJw"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["item_max_min_month <- data.frame(item_id=(unique(item_sales_by_month$item_id)), max_month=(-1), min_month=(-1))\n","#item_max_min_month"],"metadata":{"id":"abARa4lBPEb4"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["\n","for (item in item_max_min_month$item_id){\n","  max_sale <- max(item_sales_by_month[item_sales_by_month$item_id == item, \"sum_count_sales\"])\n","  item_max_min_month$max_month[item_max_min_month$item_id == item] <- item_sales_by_month[item_sales_by_month$item_id == item & item_sales_by_month$sum_count_sales == max_sale, 'month'][1]\n","  min_sale <- min(item_sales_by_month[item_sales_by_month$item_id == item, \"sum_count_sales\"])\n","  item_max_min_month$min_month[item_max_min_month$item_id == item] <- item_sales_by_month[item_sales_by_month$item_id == item & item_sales_by_month$sum_count_sales == min_sale, 'month'][1]\n","}\n","  "],"metadata":{"id":"fhkivhyZOi9g"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["Месяцы с минимальными и максимальными продажами для каждого товара из пункта 1."],"metadata":{"id":"qY8XxF5SugZp"}},{"cell_type":"code","source":["item_max_min_month"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"6MnS8Uz-Sied","executionInfo":{"status":"ok","timestamp":1648587620394,"user_tz":-180,"elapsed":43,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"14c554db-243b-483f-8cc3-9d2f0bcdc1ee"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 4966 × 3</caption>\n","<thead>\n","\t<tr><th scope=col>item_id</th><th scope=col>max_month</th><th scope=col>min_month</th></tr>\n","\t<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><td> 2462</td><td> 1</td><td> 5</td></tr>\n","\t<tr><td> 3112</td><td> 0</td><td> 7</td></tr>\n","\t<tr><td> 3093</td><td> 0</td><td> 7</td></tr>\n","\t<tr><td>  977</td><td> 0</td><td>11</td></tr>\n","\t<tr><td>  987</td><td>13</td><td>33</td></tr>\n","\t<tr><td> 1113</td><td> 1</td><td>12</td></tr>\n","\t<tr><td> 1118</td><td> 0</td><td> 4</td></tr>\n","\t<tr><td> 1070</td><td> 5</td><td> 3</td></tr>\n","\t<tr><td> 1097</td><td> 0</td><td>10</td></tr>\n","\t<tr><td> 5416</td><td> 6</td><td>12</td></tr>\n","\t<tr><td> 5525</td><td> 0</td><td> 8</td></tr>\n","\t<tr><td> 3582</td><td> 0</td><td> 7</td></tr>\n","\t<tr><td> 3603</td><td> 0</td><td> 7</td></tr>\n","\t<tr><td> 8092</td><td> 0</td><td>31</td></tr>\n","\t<tr><td> 8096</td><td>12</td><td>27</td></tr>\n","\t<tr><td> 8147</td><td> 2</td><td>10</td></tr>\n","\t<tr><td> 7709</td><td> 5</td><td>12</td></tr>\n","\t<tr><td> 5527</td><td>10</td><td>12</td></tr>\n","\t<tr><td>21732</td><td>21</td><td>11</td></tr>\n","\t<tr><td>21766</td><td> 2</td><td> 1</td></tr>\n","\t<tr><td>21865</td><td> 0</td><td>14</td></tr>\n","\t<tr><td>21871</td><td> 0</td><td>14</td></tr>\n","\t<tr><td>21876</td><td> 7</td><td>29</td></tr>\n","\t<tr><td>22014</td><td> 0</td><td>18</td></tr>\n","\t<tr><td>21552</td><td> 0</td><td> 8</td></tr>\n","\t<tr><td>20298</td><td> 5</td><td>17</td></tr>\n","\t<tr><td>20300</td><td> 1</td><td> 3</td></tr>\n","\t<tr><td>21329</td><td> 4</td><td>22</td></tr>\n","\t<tr><td>21413</td><td> 0</td><td>12</td></tr>\n","\t<tr><td>21422</td><td> 1</td><td> 7</td></tr>\n","\t<tr><td>⋮</td><td>⋮</td><td>⋮</td></tr>\n","\t<tr><td>12688</td><td>33</td><td>0</td></tr>\n","\t<tr><td>17364</td><td>33</td><td>0</td></tr>\n","\t<tr><td>17031</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19835</td><td>33</td><td>0</td></tr>\n","\t<tr><td>10447</td><td>33</td><td>0</td></tr>\n","\t<tr><td>11779</td><td>33</td><td>0</td></tr>\n","\t<tr><td>16988</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19075</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19655</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19520</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19642</td><td>33</td><td>0</td></tr>\n","\t<tr><td>22158</td><td>33</td><td>0</td></tr>\n","\t<tr><td>21449</td><td>33</td><td>0</td></tr>\n","\t<tr><td>21604</td><td>33</td><td>0</td></tr>\n","\t<tr><td> 8699</td><td>33</td><td>0</td></tr>\n","\t<tr><td>21548</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19204</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19552</td><td>33</td><td>0</td></tr>\n","\t<tr><td>17902</td><td>33</td><td>0</td></tr>\n","\t<tr><td>21664</td><td>33</td><td>0</td></tr>\n","\t<tr><td>10072</td><td>33</td><td>0</td></tr>\n","\t<tr><td>19590</td><td>33</td><td>0</td></tr>\n","\t<tr><td>11766</td><td>33</td><td>0</td></tr>\n","\t<tr><td>18723</td><td>33</td><td>0</td></tr>\n","\t<tr><td> 9583</td><td>33</td><td>0</td></tr>\n","\t<tr><td>12332</td><td>33</td><td>0</td></tr>\n","\t<tr><td>10062</td><td>33</td><td>0</td></tr>\n","\t<tr><td>  986</td><td>33</td><td>0</td></tr>\n","\t<tr><td>14709</td><td>33</td><td>0</td></tr>\n","\t<tr><td> 8428</td><td>33</td><td>0</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 4966 × 3\n\n| item_id &lt;int&gt; | max_month &lt;dbl&gt; | min_month &lt;dbl&gt; |\n|---|---|---|\n|  2462 |  1 |  5 |\n|  3112 |  0 |  7 |\n|  3093 |  0 |  7 |\n|   977 |  0 | 11 |\n|   987 | 13 | 33 |\n|  1113 |  1 | 12 |\n|  1118 |  0 |  4 |\n|  1070 |  5 |  3 |\n|  1097 |  0 | 10 |\n|  5416 |  6 | 12 |\n|  5525 |  0 |  8 |\n|  3582 |  0 |  7 |\n|  3603 |  0 |  7 |\n|  8092 |  0 | 31 |\n|  8096 | 12 | 27 |\n|  8147 |  2 | 10 |\n|  7709 |  5 | 12 |\n|  5527 | 10 | 12 |\n| 21732 | 21 | 11 |\n| 21766 |  2 |  1 |\n| 21865 |  0 | 14 |\n| 21871 |  0 | 14 |\n| 21876 |  7 | 29 |\n| 22014 |  0 | 18 |\n| 21552 |  0 |  8 |\n| 20298 |  5 | 17 |\n| 20300 |  1 |  3 |\n| 21329 |  4 | 22 |\n| 21413 |  0 | 12 |\n| 21422 |  1 |  7 |\n| ⋮ | ⋮ | ⋮ |\n| 12688 | 33 | 0 |\n| 17364 | 33 | 0 |\n| 17031 | 33 | 0 |\n| 19835 | 33 | 0 |\n| 10447 | 33 | 0 |\n| 11779 | 33 | 0 |\n| 16988 | 33 | 0 |\n| 19075 | 33 | 0 |\n| 19655 | 33 | 0 |\n| 19520 | 33 | 0 |\n| 19642 | 33 | 0 |\n| 22158 | 33 | 0 |\n| 21449 | 33 | 0 |\n| 21604 | 33 | 0 |\n|  8699 | 33 | 0 |\n| 21548 | 33 | 0 |\n| 19204 | 33 | 0 |\n| 19552 | 33 | 0 |\n| 17902 | 33 | 0 |\n| 21664 | 33 | 0 |\n| 10072 | 33 | 0 |\n| 19590 | 33 | 0 |\n| 11766 | 33 | 0 |\n| 18723 | 33 | 0 |\n|  9583 | 33 | 0 |\n| 12332 | 33 | 0 |\n| 10062 | 33 | 0 |\n|   986 | 33 | 0 |\n| 14709 | 33 | 0 |\n|  8428 | 33 | 0 |\n\n","text/latex":"A data.frame: 4966 × 3\n\\begin{tabular}{lll}\n item\\_id & max\\_month & min\\_month\\\\\n <int> & <dbl> & <dbl>\\\\\n\\hline\n\t  2462 &  1 &  5\\\\\n\t  3112 &  0 &  7\\\\\n\t  3093 &  0 &  7\\\\\n\t   977 &  0 & 11\\\\\n\t   987 & 13 & 33\\\\\n\t  1113 &  1 & 12\\\\\n\t  1118 &  0 &  4\\\\\n\t  1070 &  5 &  3\\\\\n\t  1097 &  0 & 10\\\\\n\t  5416 &  6 & 12\\\\\n\t  5525 &  0 &  8\\\\\n\t  3582 &  0 &  7\\\\\n\t  3603 &  0 &  7\\\\\n\t  8092 &  0 & 31\\\\\n\t  8096 & 12 & 27\\\\\n\t  8147 &  2 & 10\\\\\n\t  7709 &  5 & 12\\\\\n\t  5527 & 10 & 12\\\\\n\t 21732 & 21 & 11\\\\\n\t 21766 &  2 &  1\\\\\n\t 21865 &  0 & 14\\\\\n\t 21871 &  0 & 14\\\\\n\t 21876 &  7 & 29\\\\\n\t 22014 &  0 & 18\\\\\n\t 21552 &  0 &  8\\\\\n\t 20298 &  5 & 17\\\\\n\t 20300 &  1 &  3\\\\\n\t 21329 &  4 & 22\\\\\n\t 21413 &  0 & 12\\\\\n\t 21422 &  1 &  7\\\\\n\t ⋮ & ⋮ & ⋮\\\\\n\t 12688 & 33 & 0\\\\\n\t 17364 & 33 & 0\\\\\n\t 17031 & 33 & 0\\\\\n\t 19835 & 33 & 0\\\\\n\t 10447 & 33 & 0\\\\\n\t 11779 & 33 & 0\\\\\n\t 16988 & 33 & 0\\\\\n\t 19075 & 33 & 0\\\\\n\t 19655 & 33 & 0\\\\\n\t 19520 & 33 & 0\\\\\n\t 19642 & 33 & 0\\\\\n\t 22158 & 33 & 0\\\\\n\t 21449 & 33 & 0\\\\\n\t 21604 & 33 & 0\\\\\n\t  8699 & 33 & 0\\\\\n\t 21548 & 33 & 0\\\\\n\t 19204 & 33 & 0\\\\\n\t 19552 & 33 & 0\\\\\n\t 17902 & 33 & 0\\\\\n\t 21664 & 33 & 0\\\\\n\t 10072 & 33 & 0\\\\\n\t 19590 & 33 & 0\\\\\n\t 11766 & 33 & 0\\\\\n\t 18723 & 33 & 0\\\\\n\t  9583 & 33 & 0\\\\\n\t 12332 & 33 & 0\\\\\n\t 10062 & 33 & 0\\\\\n\t   986 & 33 & 0\\\\\n\t 14709 & 33 & 0\\\\\n\t  8428 & 33 & 0\\\\\n\\end{tabular}\n","text/plain":["     item_id max_month min_month\n","1     2462    1         5       \n","2     3112    0         7       \n","3     3093    0         7       \n","4      977    0        11       \n","5      987   13        33       \n","6     1113    1        12       \n","7     1118    0         4       \n","8     1070    5         3       \n","9     1097    0        10       \n","10    5416    6        12       \n","11    5525    0         8       \n","12    3582    0         7       \n","13    3603    0         7       \n","14    8092    0        31       \n","15    8096   12        27       \n","16    8147    2        10       \n","17    7709    5        12       \n","18    5527   10        12       \n","19   21732   21        11       \n","20   21766    2         1       \n","21   21865    0        14       \n","22   21871    0        14       \n","23   21876    7        29       \n","24   22014    0        18       \n","25   21552    0         8       \n","26   20298    5        17       \n","27   20300    1         3       \n","28   21329    4        22       \n","29   21413    0        12       \n","30   21422    1         7       \n","⋮    ⋮       ⋮         ⋮        \n","4937 12688   33        0        \n","4938 17364   33        0        \n","4939 17031   33        0        \n","4940 19835   33        0        \n","4941 10447   33        0        \n","4942 11779   33        0        \n","4943 16988   33        0        \n","4944 19075   33        0        \n","4945 19655   33        0        \n","4946 19520   33        0        \n","4947 19642   33        0        \n","4948 22158   33        0        \n","4949 21449   33        0        \n","4950 21604   33        0        \n","4951  8699   33        0        \n","4952 21548   33        0        \n","4953 19204   33        0        \n","4954 19552   33        0        \n","4955 17902   33        0        \n","4956 21664   33        0        \n","4957 10072   33        0        \n","4958 19590   33        0        \n","4959 11766   33        0        \n","4960 18723   33        0        \n","4961  9583   33        0        \n","4962 12332   33        0        \n","4963 10062   33        0        \n","4964   986   33        0        \n","4965 14709   33        0        \n","4966  8428   33        0        "]},"metadata":{}}]},{"cell_type":"markdown","metadata":{"id":"d11G2DP4KLUy"},"source":["# Задание 4"]},{"cell_type":"markdown","metadata":{"id":"RX3FC6lbKLUz"},"source":["1. Для категорий из задания 2 найдите среднюю и медианную цену по категории в пределах каждого месяца.\n","2. В каждом году найдите месяцы, в которых средняя цена меньше, чем в предыдущем и следующем месяце."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zpwSYpteKLU0"},"outputs":[],"source":["id_categ <- c()\n","months <- c()\n","mean_price <- c()\n","median_price <- c()\n","for (categ in need_categories){\n","  for (month in unique(sales$date_block_num)){\n","    price <- sales[(sales$item_id %in% items[items$category_id == categ, 'item_id']) & (sales$date_block_num == month), 'item_price']\n","    id_categ <- c(id_categ, categ)\n","    months <- c(months, month)\n","    mean_price <- c(mean_price, mean(price))\n","    median_price <- c(median_price, median(price))\n","  }\n","}\n"]},{"cell_type":"markdown","source":["Средняя и медианная цена по категории в пределах каждого месяца"],"metadata":{"id":"PE9ApNnYu0tg"}},{"cell_type":"code","source":["category_months_prices <- data.frame(category_id=(id_categ), month=(months), mean_price=(mean_price), median_price=(median_price))\n","category_months_prices <- category_months_prices[!is.na(category_months_prices$mean_price),]\n","category_months_prices"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"v8N4Il8FkFzb","executionInfo":{"status":"ok","timestamp":1648587630025,"user_tz":-180,"elapsed":38,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"66e3673e-d07d-4b11-ed53-eb30b2948124"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 36 × 4</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>category_id</th><th scope=col>month</th><th scope=col>mean_price</th><th scope=col>median_price</th></tr>\n","\t<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>1</th><td>40</td><td> 0</td><td> 244.4859</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>2</th><td>40</td><td> 1</td><td> 252.1749</td><td> 203.00</td></tr>\n","\t<tr><th scope=row>3</th><td>40</td><td> 2</td><td> 260.6450</td><td> 231.00</td></tr>\n","\t<tr><th scope=row>4</th><td>40</td><td> 3</td><td> 254.8524</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>5</th><td>40</td><td> 4</td><td> 247.6276</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>6</th><td>40</td><td> 5</td><td> 245.8609</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>7</th><td>40</td><td> 6</td><td> 236.8121</td><td> 149.00</td></tr>\n","\t<tr><th scope=row>8</th><td>40</td><td> 7</td><td> 234.4702</td><td> 149.00</td></tr>\n","\t<tr><th scope=row>9</th><td>40</td><td> 8</td><td> 241.8186</td><td> 198.00</td></tr>\n","\t<tr><th scope=row>10</th><td>40</td><td> 9</td><td> 247.5439</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>11</th><td>40</td><td>10</td><td> 253.2127</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>12</th><td>40</td><td>11</td><td> 257.7663</td><td> 237.00</td></tr>\n","\t<tr><th scope=row>13</th><td>40</td><td>12</td><td> 252.9098</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>14</th><td>40</td><td>13</td><td> 261.2565</td><td> 248.00</td></tr>\n","\t<tr><th scope=row>15</th><td>40</td><td>14</td><td> 262.4360</td><td> 251.00</td></tr>\n","\t<tr><th scope=row>16</th><td>40</td><td>15</td><td> 268.4081</td><td> 249.00</td></tr>\n","\t<tr><th scope=row>17</th><td>40</td><td>16</td><td> 254.3645</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>18</th><td>40</td><td>17</td><td> 255.1581</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>19</th><td>40</td><td>18</td><td> 257.3948</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>20</th><td>40</td><td>19</td><td> 264.0901</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>21</th><td>40</td><td>20</td><td> 265.3885</td><td> 240.00</td></tr>\n","\t<tr><th scope=row>22</th><td>40</td><td>21</td><td> 263.7517</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>23</th><td>40</td><td>22</td><td> 264.0330</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>24</th><td>40</td><td>23</td><td> 261.9187</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>25</th><td>40</td><td>24</td><td> 263.2980</td><td> 200.78</td></tr>\n","\t<tr><th scope=row>26</th><td>40</td><td>25</td><td> 256.3624</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>27</th><td>40</td><td>26</td><td> 258.1940</td><td> 169.00</td></tr>\n","\t<tr><th scope=row>28</th><td>40</td><td>27</td><td> 281.6307</td><td> 299.00</td></tr>\n","\t<tr><th scope=row>29</th><td>40</td><td>28</td><td> 286.5086</td><td> 299.00</td></tr>\n","\t<tr><th scope=row>30</th><td>40</td><td>29</td><td> 279.1423</td><td> 249.00</td></tr>\n","\t<tr><th scope=row>31</th><td>40</td><td>30</td><td> 273.2515</td><td> 199.00</td></tr>\n","\t<tr><th scope=row>32</th><td>40</td><td>31</td><td> 273.2421</td><td> 249.00</td></tr>\n","\t<tr><th scope=row>33</th><td>40</td><td>32</td><td> 279.3937</td><td> 249.00</td></tr>\n","\t<tr><th scope=row>34</th><td>40</td><td>33</td><td> 281.0002</td><td> 249.00</td></tr>\n","\t<tr><th scope=row>38</th><td>10</td><td> 3</td><td>1998.0000</td><td>1998.00</td></tr>\n","\t<tr><th scope=row>87</th><td>51</td><td>18</td><td> 129.0000</td><td> 129.00</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 36 × 4\n\n| <!--/--> | category_id &lt;int&gt; | month &lt;int&gt; | mean_price &lt;dbl&gt; | median_price &lt;dbl&gt; |\n|---|---|---|---|---|\n| 1 | 40 |  0 |  244.4859 |  199.00 |\n| 2 | 40 |  1 |  252.1749 |  203.00 |\n| 3 | 40 |  2 |  260.6450 |  231.00 |\n| 4 | 40 |  3 |  254.8524 |  199.00 |\n| 5 | 40 |  4 |  247.6276 |  199.00 |\n| 6 | 40 |  5 |  245.8609 |  199.00 |\n| 7 | 40 |  6 |  236.8121 |  149.00 |\n| 8 | 40 |  7 |  234.4702 |  149.00 |\n| 9 | 40 |  8 |  241.8186 |  198.00 |\n| 10 | 40 |  9 |  247.5439 |  199.00 |\n| 11 | 40 | 10 |  253.2127 |  199.00 |\n| 12 | 40 | 11 |  257.7663 |  237.00 |\n| 13 | 40 | 12 |  252.9098 |  199.00 |\n| 14 | 40 | 13 |  261.2565 |  248.00 |\n| 15 | 40 | 14 |  262.4360 |  251.00 |\n| 16 | 40 | 15 |  268.4081 |  249.00 |\n| 17 | 40 | 16 |  254.3645 |  199.00 |\n| 18 | 40 | 17 |  255.1581 |  199.00 |\n| 19 | 40 | 18 |  257.3948 |  199.00 |\n| 20 | 40 | 19 |  264.0901 |  199.00 |\n| 21 | 40 | 20 |  265.3885 |  240.00 |\n| 22 | 40 | 21 |  263.7517 |  199.00 |\n| 23 | 40 | 22 |  264.0330 |  199.00 |\n| 24 | 40 | 23 |  261.9187 |  199.00 |\n| 25 | 40 | 24 |  263.2980 |  200.78 |\n| 26 | 40 | 25 |  256.3624 |  199.00 |\n| 27 | 40 | 26 |  258.1940 |  169.00 |\n| 28 | 40 | 27 |  281.6307 |  299.00 |\n| 29 | 40 | 28 |  286.5086 |  299.00 |\n| 30 | 40 | 29 |  279.1423 |  249.00 |\n| 31 | 40 | 30 |  273.2515 |  199.00 |\n| 32 | 40 | 31 |  273.2421 |  249.00 |\n| 33 | 40 | 32 |  279.3937 |  249.00 |\n| 34 | 40 | 33 |  281.0002 |  249.00 |\n| 38 | 10 |  3 | 1998.0000 | 1998.00 |\n| 87 | 51 | 18 |  129.0000 |  129.00 |\n\n","text/latex":"A data.frame: 36 × 4\n\\begin{tabular}{r|llll}\n  & category\\_id & month & mean\\_price & median\\_price\\\\\n  & <int> & <int> & <dbl> & <dbl>\\\\\n\\hline\n\t1 & 40 &  0 &  244.4859 &  199.00\\\\\n\t2 & 40 &  1 &  252.1749 &  203.00\\\\\n\t3 & 40 &  2 &  260.6450 &  231.00\\\\\n\t4 & 40 &  3 &  254.8524 &  199.00\\\\\n\t5 & 40 &  4 &  247.6276 &  199.00\\\\\n\t6 & 40 &  5 &  245.8609 &  199.00\\\\\n\t7 & 40 &  6 &  236.8121 &  149.00\\\\\n\t8 & 40 &  7 &  234.4702 &  149.00\\\\\n\t9 & 40 &  8 &  241.8186 &  198.00\\\\\n\t10 & 40 &  9 &  247.5439 &  199.00\\\\\n\t11 & 40 & 10 &  253.2127 &  199.00\\\\\n\t12 & 40 & 11 &  257.7663 &  237.00\\\\\n\t13 & 40 & 12 &  252.9098 &  199.00\\\\\n\t14 & 40 & 13 &  261.2565 &  248.00\\\\\n\t15 & 40 & 14 &  262.4360 &  251.00\\\\\n\t16 & 40 & 15 &  268.4081 &  249.00\\\\\n\t17 & 40 & 16 &  254.3645 &  199.00\\\\\n\t18 & 40 & 17 &  255.1581 &  199.00\\\\\n\t19 & 40 & 18 &  257.3948 &  199.00\\\\\n\t20 & 40 & 19 &  264.0901 &  199.00\\\\\n\t21 & 40 & 20 &  265.3885 &  240.00\\\\\n\t22 & 40 & 21 &  263.7517 &  199.00\\\\\n\t23 & 40 & 22 &  264.0330 &  199.00\\\\\n\t24 & 40 & 23 &  261.9187 &  199.00\\\\\n\t25 & 40 & 24 &  263.2980 &  200.78\\\\\n\t26 & 40 & 25 &  256.3624 &  199.00\\\\\n\t27 & 40 & 26 &  258.1940 &  169.00\\\\\n\t28 & 40 & 27 &  281.6307 &  299.00\\\\\n\t29 & 40 & 28 &  286.5086 &  299.00\\\\\n\t30 & 40 & 29 &  279.1423 &  249.00\\\\\n\t31 & 40 & 30 &  273.2515 &  199.00\\\\\n\t32 & 40 & 31 &  273.2421 &  249.00\\\\\n\t33 & 40 & 32 &  279.3937 &  249.00\\\\\n\t34 & 40 & 33 &  281.0002 &  249.00\\\\\n\t38 & 10 &  3 & 1998.0000 & 1998.00\\\\\n\t87 & 51 & 18 &  129.0000 &  129.00\\\\\n\\end{tabular}\n","text/plain":["   category_id month mean_price median_price\n","1  40           0     244.4859   199.00     \n","2  40           1     252.1749   203.00     \n","3  40           2     260.6450   231.00     \n","4  40           3     254.8524   199.00     \n","5  40           4     247.6276   199.00     \n","6  40           5     245.8609   199.00     \n","7  40           6     236.8121   149.00     \n","8  40           7     234.4702   149.00     \n","9  40           8     241.8186   198.00     \n","10 40           9     247.5439   199.00     \n","11 40          10     253.2127   199.00     \n","12 40          11     257.7663   237.00     \n","13 40          12     252.9098   199.00     \n","14 40          13     261.2565   248.00     \n","15 40          14     262.4360   251.00     \n","16 40          15     268.4081   249.00     \n","17 40          16     254.3645   199.00     \n","18 40          17     255.1581   199.00     \n","19 40          18     257.3948   199.00     \n","20 40          19     264.0901   199.00     \n","21 40          20     265.3885   240.00     \n","22 40          21     263.7517   199.00     \n","23 40          22     264.0330   199.00     \n","24 40          23     261.9187   199.00     \n","25 40          24     263.2980   200.78     \n","26 40          25     256.3624   199.00     \n","27 40          26     258.1940   169.00     \n","28 40          27     281.6307   299.00     \n","29 40          28     286.5086   299.00     \n","30 40          29     279.1423   249.00     \n","31 40          30     273.2515   199.00     \n","32 40          31     273.2421   249.00     \n","33 40          32     279.3937   249.00     \n","34 40          33     281.0002   249.00     \n","38 10           3    1998.0000  1998.00     \n","87 51          18     129.0000   129.00     "]},"metadata":{}}]},{"cell_type":"code","source":["years <- c()\n","months <- c()\n","price <- c()\n","for (year in unique(str_sub(sales$date, start=7))){\n","  for (month in unique(sales$date_block_num)){\n","    price <- c(price, mean(sales[(str_sub(sales$date, start=7) == year) & (sales$date_block_num == month), 'item_price']))\n","    years <- c(years, year)\n","    months <- c(months, month)\n","  }\n","}\n","year_month_av_prices <- data.frame(year=(years), month=(months), average_price=(price))\n","year_month_av_prices <- year_month_av_prices[!is.na(year_month_av_prices$average_price),]\n","year_month_av_prices"],"metadata":{"id":"DGzLBeeFPCKR"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["Месяцы, в которых средняя цена меньше, чем в предыдущем и следующем месяце"],"metadata":{"id":"AoTUiKs9u8Sn"}},{"cell_type":"code","source":["ind <- c()\n","for (i in (3:nrow(year_month_av_prices)-1)){\n","  if ((year_month_av_prices[i, 'average_price'] < year_month_av_prices[i-1, 'average_price']) & (year_month_av_prices[i, 'average_price'] < year_month_av_prices[i+1, 'average_price'])){\n","    ind <- c(ind, i)\n","  }\n","}\n","year_month_av_prices[ind,]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":318},"id":"-Xo4hCpkRzyY","executionInfo":{"status":"ok","timestamp":1648587656670,"user_tz":-180,"elapsed":36,"user":{"displayName":"Виктория Бабан","userId":"08740317165102977781"}},"outputId":"cbc4ba0a-1c2e-4c4a-a047-1c430b03c42a"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 7 × 3</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>year</th><th scope=col>month</th><th scope=col>average_price</th></tr>\n","\t<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>5</th><td>2013</td><td> 4</td><td> 624.1800</td></tr>\n","\t<tr><th scope=row>7</th><td>2013</td><td> 6</td><td> 618.5782</td></tr>\n","\t<tr><th scope=row>47</th><td>2014</td><td>12</td><td> 862.8691</td></tr>\n","\t<tr><th scope=row>50</th><td>2014</td><td>15</td><td> 852.1602</td></tr>\n","\t<tr><th scope=row>53</th><td>2014</td><td>18</td><td> 847.0464</td></tr>\n","\t<tr><th scope=row>94</th><td>2015</td><td>25</td><td>1010.4654</td></tr>\n","\t<tr><th scope=row>100</th><td>2015</td><td>31</td><td> 951.3741</td></tr>\n","</tbody>\n","</table>\n"],"text/markdown":"\nA data.frame: 7 × 3\n\n| <!--/--> | year &lt;chr&gt; | month &lt;int&gt; | average_price &lt;dbl&gt; |\n|---|---|---|---|\n| 5 | 2013 |  4 |  624.1800 |\n| 7 | 2013 |  6 |  618.5782 |\n| 47 | 2014 | 12 |  862.8691 |\n| 50 | 2014 | 15 |  852.1602 |\n| 53 | 2014 | 18 |  847.0464 |\n| 94 | 2015 | 25 | 1010.4654 |\n| 100 | 2015 | 31 |  951.3741 |\n\n","text/latex":"A data.frame: 7 × 3\n\\begin{tabular}{r|lll}\n  & year & month & average\\_price\\\\\n  & <chr> & <int> & <dbl>\\\\\n\\hline\n\t5 & 2013 &  4 &  624.1800\\\\\n\t7 & 2013 &  6 &  618.5782\\\\\n\t47 & 2014 & 12 &  862.8691\\\\\n\t50 & 2014 & 15 &  852.1602\\\\\n\t53 & 2014 & 18 &  847.0464\\\\\n\t94 & 2015 & 25 & 1010.4654\\\\\n\t100 & 2015 & 31 &  951.3741\\\\\n\\end{tabular}\n","text/plain":["    year month average_price\n","5   2013  4     624.1800    \n","7   2013  6     618.5782    \n","47  2014 12     862.8691    \n","50  2014 15     852.1602    \n","53  2014 18     847.0464    \n","94  2015 25    1010.4654    \n","100 2015 31     951.3741    "]},"metadata":{}}]}],"metadata":{"colab":{"name":"Практическая работа 1 R","provenance":[],"authorship_tag":"ABX9TyP3aGierK7khB7R9cp+4R/b"},"kernelspec":{"display_name":"R","name":"ir"},"language_info":{"name":"R"}},"nbformat":4,"nbformat_minor":0}